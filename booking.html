<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Booking-Off – BrickBook</title>

<style>
/* -----------------------------------
   COLOURS / BASE THEME
----------------------------------- */
:root {
    --blue: #1B73E8;
    --charcoal: #2D2D2D;
    --lightgrey: #F5F7FA;
    --white: #FFFFFF;
}

/* -----------------------------------
   GENERAL LAYOUT
----------------------------------- */
body {
    margin: 0;
    background: var(--lightgrey);
    font-family: 'Inter', Arial, sans-serif;
    color: var(--charcoal);
}

/* -----------------------------------
   HEADER / NAVBAR
----------------------------------- */
header {
    background: var(--white);
    padding: 18px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #E5EAF0;
    position: sticky;
    top: 0;
    z-index: 200;
}

.logo {
    font-size: 22px;
    font-weight: 800;
}

nav {
    display: flex;
    gap: 24px;
}

nav a {
    text-decoration: none;
    color: var(--charcoal);
    font-weight: 600;
}
nav a:hover { color: var(--blue); }

/* MOBILE NAV */
.hamburger {
    display: none;
    font-size: 28px;
    cursor: pointer;
}

.mobile-menu {
    display: none;
    flex-direction: column;
    background: white;
    padding: 16px;
    border-bottom: 1px solid #ddd;
}

.mobile-menu a {
    padding: 10px 0;
    border-bottom: 1px solid #eee;
    text-decoration: none;
    color: var(--charcoal);
    font-weight: 600;
}

/* -----------------------------------
   PAGE WRAPPER
----------------------------------- */
.wrapper {
    max-width: 900px;
    margin: 0 auto;
    padding: 30px 20px 80px;
}

/* -----------------------------------
   TITLES
----------------------------------- */
h1 {
    font-size: 32px;
    font-weight: 800;
}

.subtitle {
    color: #666;
    margin-bottom: 20px;
}

/* -----------------------------------
   PLOT CARD
----------------------------------- */
.plot-card {
    background: white;
    border-radius: 14px;
    padding: 18px;
    margin-bottom: 24px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.05);
    position: relative;
}

.delete-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #ffe2e2;
    color: #b00000;
    border: 1px solid #ffb3b3;
    padding: 4px 12px;
    font-size: 12px;
    border-radius: 6px;
    cursor: pointer;
}

/* -----------------------------------
   TABLES
----------------------------------- */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
}

thead {
    background: #e7efff;
}

th, td {
    padding: 8px;
    border-bottom: 1px solid #e3e3e3;
    font-size: 14px;
}

/* -----------------------------------
   INPUTS
----------------------------------- */
input[type="number"],
input[type="text"],
input[type="file"],
textarea {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 14px;
}

textarea {
    height: 70px;
    margin-top: 6px;
    margin-bottom: 12px;
}

/* Remove numeric arrows */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }
input[type="number"] { -moz-appearance:textfield; }

/* -----------------------------------
   PHOTO PREVIEW
----------------------------------- */
.photo-preview {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 10px;
}

.photo-preview img {
    width: 85px;
    height: 85px;
    object-fit: cover;
    border-radius: 6px;
    border: 1px solid #ccc;
}

/* -----------------------------------
   TOTALS
----------------------------------- */
.plot-total-box {
    text-align: right;
    font-size: 16px;
    font-weight: 700;
    margin-top: 8px;
}

.grand-total-box {
    text-align: right;
    font-size: 22px;
    font-weight: 800;
    margin: 40px 0;
}

/* -----------------------------------
   BUTTONS
----------------------------------- */
.btn-secondary {
    padding: 12px 20px;
    background: #eef2ff;
    color: var(--blue);
    border: 1px solid #c5d4ff;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 20px;
}

.btn-primary {
    padding: 14px 22px;
    background: var(--blue);
    color: white;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-weight: 700;
    float: right;
}

/* -----------------------------------
   SPLIT CARD
----------------------------------- */
.split-card {
    background: white;
    padding: 22px;
    margin-top: 35px;
    border-radius: 16px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.05);
}

.split-header {
    font-size: 20px;
    font-weight: 800;
    margin-bottom: 15px;
}

.split-row {
    display: grid;
    grid-template-columns: 1fr 90px 120px 140px;
    gap: 10px;
    margin-bottom: 8px;
}

/* -----------------------------------
   MOBILE RESPONSIVE
----------------------------------- */
@media(max-width: 768px) {

    nav { display: none; }
    .hamburger { display: block; }

    .wrapper { padding: 16px; }

    .plot-card { width: 100%; }

    .split-row {
        grid-template-columns: 1fr 70px 90px 90px;
    }

    .btn-primary,
    .btn-secondary {
        width: 100%;
        float: none;
        margin-top: 12px;
    }

    h1 { font-size: 26px; }
}
</style>
</head>

<body>

<!-- HEADER -->
<header>
    <div class="logo">BrickBook</div>

    <nav>
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="contractor-login.html" onclick="logout()">Logout</a>
    </nav>

    <div class="hamburger" onclick="toggleMenu()">☰</div>
</header>

<!-- MOBILE MENU -->
<div class="mobile-menu" id="mobileMenu">
    <a href="index.html">Home</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="contractor-login.html">Logout</a>
</div>

<!-- MAIN WRAPPER -->
<div class="wrapper">

    <h1>Booking-Off</h1>
    <div class="subtitle">Add your plots, notes, photos and wage splits below.</div>

    <button class="btn-secondary" onclick="addPlot()">+ Add Plot</button>

    <div id="plots-container"></div>

    <div class="grand-total-box">
        Grand Total for All Plots: £<span id="grand-total">0.00</span>
    </div>

    <!-- Squad Split -->
    <div class="split-card">
        <div class="split-header">Squad Split (5 People)</div>

        <div class="split-row" style="font-weight:bold;">
            <div>Name</div>
            <div>%</div>
            <div>Wages (£)</div>
            <div>After CIS</div>
        </div>

        <div id="split-container"></div>

        <div class="grand-total-box">
            Total Paid After CIS: £<span id="final-total-cis">0.00</span>
        </div>
    </div>

    <button class="btn-primary" onclick="submitBooking()">Submit Booking-Off</button>

</div>

<!-- SCRIPT -->
<script>
function toggleMenu() {
    const menu = document.getElementById("mobileMenu");
    menu.style.display = menu.style.display === "flex" ? "none" : "flex";
}

/* -----------------------------------
   RATES
----------------------------------- */
const measurementTypes = [
    { name: "Bricks", rate: 0.6 },
    { name: "Trench", rate: 25 },
    { name: "100mm", rate: 16 },
    { name: "Commons", rate: 0.35 },
    { name: "Squad Hours", rate: 50 },
    { name: "Lintel", rate: 2 }
];

/* -----------------------------------
   ADD PLOT
----------------------------------- */
function addPlot() {
    const container = document.getElementById("plots-container");
    const card = document.createElement("div");
    const id = Date.now();

    card.className = "plot-card";

    card.innerHTML = `
        <button class="delete-btn" onclick="deletePlot(this)">X</button>

        <div class="plot-title">
            Plot <input type="text" placeholder="e.g. 44" class="plot-number">
        </div>

        <table>
            <thead>
                <tr>
                    <th>Measurement</th>
                    <th>Qty</th>
                    <th>Rate (£)</th>
                    <th>Total (£)</th>
                </tr>
            </thead>
            <tbody>
                ${measurementTypes.map(m => `
                    <tr>
                        <td>${m.name}</td>
                        <td><input type="number" class="qty" oninput="calcRow(this); calcPlot(this)"></td>
                        <td><input type="number" class="rate" value="${m.rate}" readonly></td>
                        <td><input type="number" class="total" readonly></td>
                    </tr>
                `).join("")}
            </tbody>
        </table>

        <label>Notes</label>
        <textarea class="plot-notes" placeholder="Progress, issues, weather, missing materials..."></textarea>

        <label>Upload Photos:</label>
        <input type="file" accept="image/*" onchange="previewPhoto(this, '${id}')">
        <button class="btn-secondary" onclick="addPhotoField(this, '${id}')">+ Add Photo</button>

        <div class="photo-preview" id="preview-${id}"></div>

        <div class="plot-total-box">
            Plot Total: £<span class="plot-total">0.00</span>
        </div>
    `;

    container.appendChild(card);
}

function deletePlot(btn) {
    btn.closest(".plot-card").remove();
    calcGrandTotal();
    calcSplitTotals();
}

/* -----------------------------------
   PHOTO UPLOAD
----------------------------------- */
function addPhotoField(btn, id) {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*";
    input.onchange = () => previewPhoto(input, id);
    btn.insertAdjacentElement("beforebegin", input);
}

function previewPhoto(input, id) {
    const container = document.getElementById("preview-" + id);
    if (!input.files || !input.files[0]) return;

    const img = document.createElement("img");
    img.src = URL.createObjectURL(input.files[0]);
    container.appendChild(img);
}

/* -----------------------------------
   CALCULATIONS
----------------------------------- */
function calcRow(input) {
    const row = input.closest("tr");
    const qty = parseFloat(input.value) || 0;
    const rate = parseFloat(row.querySelector(".rate").value) || 0;
    row.querySelector(".total").value = (qty * rate).toFixed(2);
}

function calcPlot(input) {
    const card = input.closest(".plot-card");
    let total = 0;

    card.querySelectorAll(".total").forEach(t => {
        total += parseFloat(t.value) || 0;
    });

    card.querySelector(".plot-total").textContent = total.toFixed(2);

    calcGrandTotal();
    calcSplitTotals();
}

function calcGrandTotal() {
    let sum = 0;
    document.querySelectorAll(".plot-total").forEach(t => {
        sum += parseFloat(t.textContent) || 0;
    });

    document.getElementById("grand-total").textContent = sum.toFixed(2);
}

/* -----------------------------------
   SQUAD SPLIT (5 PEOPLE)
----------------------------------- */
const splitContainer = document.getElementById("split-container");

for (let i = 0; i < 5; i++) addSplitRow();

function addSplitRow() {
    const row = document.createElement("div");
    row.className = "split-row";

    row.innerHTML = `
        <input type="text" class="split-name">
        <input type="number" class="split-percent" oninput="percentChanged(this)">
        <input type="number" class="split-wages" oninput="wagesChanged(this)">
        <input type="number" class="split-cis" readonly>
    `;

    splitContainer.appendChild(row);
}

function percentChanged(input) {
    const row = input.closest(".split-row");
    const percent = parseFloat(input.value) || 0;
    const grand = parseFloat(document.getElementById("grand-total").textContent) || 0;

    const wages = grand * (percent / 100);
    row.querySelector(".split-wages").value = wages.toFixed(2);
    row.querySelector(".split-cis").value = (wages * 0.8).toFixed(2);

    calcSplitTotals();
}

function wagesChanged(input) {
    const row = input.closest(".split-row");
    const wages = parseFloat(input.value) || 0;
    const grand = parseFloat(document.getElementById("grand-total").textContent) || 0;

    if (grand > 0) {
        row.querySelector(".split-percent").value = ((wages / grand) * 100).toFixed(2);
    }

    row.querySelector(".split-cis").value = (wages * 0.8).toFixed(2);

    calcSplitTotals();
}

function calcSplitTotals() {
    let totalCIS = 0;
    document.querySelectorAll(".split-cis").forEach(c => {
        totalCIS += parseFloat(c.value) || 0;
    });

    document.getElementById("final-total-cis").textContent = totalCIS.toFixed(2);
}

function submitBooking() {
    alert("Booking-Off Submitted Successfully!");
}
</script>

</body>
</html>
