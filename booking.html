<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking-Off – BrickBook</title>

    <style>
        :root {
            --blue: #1B73E8;
            --charcoal: #2D2D2D;
            --lightgrey: #F5F7FA;
            --white: #FFFFFF;
        }

        /* GENERAL */
        body {
            margin: 0;
            background: var(--lightgrey);
            font-family: 'Inter', Arial, sans-serif;
            color: var(--charcoal);
        }

        /* HEADER (restored) */
        header {
            background: var(--white);
            padding: 18px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #E5EAF0;
            position: sticky;
            top: 0;
            z-index: 200;
        }
        .logo { font-size: 20px; font-weight: 700; }
        nav a {
            margin-left: 20px;
            text-decoration: none;
            color: var(--charcoal);
            font-weight: 600;
        }
        nav a:hover { color: var(--blue); }

        .wrapper {
            max-width: 1100px;
            margin: 0 auto;
            padding: 30px 20px 80px;
        }

        h1 { font-size: 28px; font-weight: 800; }
        .subtitle { color: #666; margin-bottom: 20px; }

        /* PLOT CARDS */
        .plot-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 22px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.05);
            max-width: 700px;
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffe2e2;
            color: #b00000;
            border: 1px solid #ffb3b3;
            padding: 4px 10px;
            font-size: 12px;
            border-radius: 6px;
            cursor: pointer;
        }

        textarea {
            width: 100%;
            height: 70px;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
            resize: vertical;
            margin-top: 6px;
            margin-bottom: 12px;
        }

        .plot-title input {
            width: 100px;
            padding: 6px;
            border-radius: 6px;
            border: 1px solid #dcdcdc;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }

        thead { background: #e7efff; }
        th, td { padding: 6px 8px; border-bottom: 1px solid #e3e3e3; }

        /* Inputs & remove spinner */
        input[type="number"], input[type="text"], input[type="file"] {
            width: 100%;
            padding: 6px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }
        input[type="number"] { -moz-appearance: textfield; }

        /* Photo preview thumbnails */
        .photo-preview {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .photo-preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .plot-total-box {
            text-align: right;
            font-size: 16px;
            font-weight: 700;
            margin-top: 8px;
        }

        .grand-total-box {
            text-align: right;
            font-size: 22px;
            font-weight: 800;
            margin: 40px 0;
        }

        .btn-secondary {
            padding: 10px 18px;
            background: #eef2ff;
            color: var(--blue);
            border: 1px solid #c5d4ff;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .btn-primary {
            padding: 12px 20px;
            background: var(--blue);
            color: white;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            float: right;
        }

        /* SQUAD SPLIT */
        .split-card {
            background: white;
            padding: 20px;
            margin-top: 35px;
            border-radius: 16px;
            max-width: 700px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.05);
        }

        .split-header {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 15px;
        }

        .split-row {
            display: grid;
            grid-template-columns: 1fr 90px 120px 140px;
            gap: 10px;
            margin-bottom: 8px;
            align-items: center;
        }

        .final-split-total {
            text-align: right;
            font-size: 20px;
            font-weight: 800;
            margin-top: 20px;
        }

        /* MOBILE VERSION */
        @media (max-width: 768px) {

            .wrapper { padding: 15px; }

            header { padding: 14px 16px; }
            nav a { margin-left: 12px; font-size: 14px; }

            .plot-card { max-width: 100%; padding: 14px; }

            .plot-title { font-size: 16px; }
            .plot-title input { width: 70px; }

            .delete-btn { padding: 3px 8px; font-size: 11px; }

            table { font-size: 13px; }
            th, td { padding: 6px 5px; }

            .split-card { max-width: 100%; padding: 16px; }

            .split-row {
                grid-template-columns: 1fr 70px 90px 90px;
                gap: 6px;
            }

            .btn-secondary,
            .btn-primary {
                width: 100%;
                float: none;
                margin-top: 12px;
            }

            .plot-total-box,
            .grand-total-box,
            .final-split-total { font-size: 16px; }
        }
    </style>
</head>

<body>

<header>
    <div class="logo">BrickBook</div>
    <nav>
        <a href="#">Home</a>
        <a href="#">Dashboard</a>
        <a href="#">Logout</a>
    </nav>
</header>

<div class="wrapper">

    <h1>Booking-Off</h1>
    <div class="subtitle">Add your plots, notes, photos and wage splits below.</div>

    <button class="btn-secondary" onclick="addPlot()">+ Add Plot</button>

    <div id="plots-container"></div>

    <div class="grand-total-box">
        Grand Total for All Plots: £<span id="grand-total">0.00</span>
    </div>

    <!-- Squad Split -->
    <div class="split-card">
        <div class="split-header">Squad Split (5 People)</div>

        <div class="split-row" style="font-weight:700;">
            <div>Name</div>
            <div>%</div>
            <div>Wages (£)</div>
            <div>After CIS</div>
        </div>

        <div id="split-container"></div>

        <div class="final-split-total">
            Total Paid After CIS: £<span id="final-total-cis">0.00</span>
        </div>
    </div>

    <button class="btn-primary" onclick="submitBooking()">Submit Booking-Off</button>

</div>

<script>

    /* RATES */
    const measurementTypes = [
        { name: "Bricks", rate: 0.6 },
        { name: "Trench", rate: 25 },
        { name: "100mm", rate: 16 },
        { name: "Commons", rate: 0.35 },
        { name: "Squad Hours", rate: 50 },
        { name: "Lintel", rate: 2 }
    ];

    /* ADD PLOT */
    function addPlot() {
        const container = document.getElementById("plots-container");

        const card = document.createElement("div");
        card.className = "plot-card";

        const id = Date.now(); // unique ID for photo preview

        card.innerHTML = `
            <button class="delete-btn" onclick="deletePlot(this)">X</button>

            <div class="plot-title">
                Plot <input type="text" placeholder="e.g. 44" class="plot-number">
            </div>

           <!-- Work table FIRST -->
<table>
    <thead>
        <tr>
            <th>Measurement</th>
            <th>Qty</th>
            <th>Rate (£)</th>
            <th>Total (£)</th>
        </tr>
    </thead>
    <tbody>
        ${measurementTypes.map(m => `
            <tr>
                <td>${m.name}</td>
                <td><input type="number" class="qty" oninput="calcRow(this); calcPlot(this)"></td>
                <td><input type="number" class="rate" value="${m.rate}" readonly></td>
                <td><input type="number" class="total" readonly></td>
            </tr>
        `).join("")}
    </tbody>
</table>

<!-- Notes NOW below measurements -->
<label>Notes for this plot:</label>
<textarea class="plot-notes" placeholder="Progress, issues, weather, missing materials etc..."></textarea>

<!-- Photo Upload below notes -->
<label>Upload Photos:</label>
<input type="file" accept="image/*" onchange="previewPhoto(this, '${id}')">
<button class="btn-secondary" style="margin-top:10px;" onclick="addPhotoField(this, '${id}')">+ Add Photo</button>

<div class="photo-preview" id="preview-${id}"></div>

<!-- Total at the bottom -->
<div class="plot-total-box">
    Plot Total: £<span class="plot-total">0.00</span>
</div>

        `;

        container.appendChild(card);
    }

    function addPhotoField(btn, id) {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";
        input.onchange = () => previewPhoto(input, id);
        btn.insertAdjacentElement("beforebegin", input);
    }

    function previewPhoto(input, id) {
        const container = document.getElementById("preview-" + id);
        if (!input.files || !input.files[0]) return;

        const img = document.createElement("img");
        img.src = URL.createObjectURL(input.files[0]);
        container.appendChild(img);
    }

    function deletePlot(btn) {
        btn.closest(".plot-card").remove();
        calcGrandTotal();
        calcSplitTotals();
    }

    /* CALCS */
    function calcRow(input) {
        const row = input.closest("tr");
        const qty = parseFloat(input.value) || 0;
        const rate = parseFloat(row.querySelector(".rate").value) || 0;
        row.querySelector(".total").value = (qty * rate).toFixed(2);
    }

    function calcPlot(input) {
        const card = input.closest(".plot-card");
        let total = 0;
        card.querySelectorAll(".total").forEach(t => total += parseFloat(t.value) || 0);
        card.querySelector(".plot-total").textContent = total.toFixed(2);
        calcGrandTotal();
        calcSplitTotals();
    }

    function calcGrandTotal() {
        let sum = 0;
        document.querySelectorAll(".plot-total").forEach(t => sum += parseFloat(t.textContent) || 0);
        document.getElementById("grand-total").textContent = sum.toFixed(2);
    }

    /* SPLIT SECTION */
    const splitContainer = document.getElementById("split-container");
    for (let i = 0; i < 5; i++) addSplitRow();

    function addSplitRow() {
        const row = document.createElement("div");
        row.className = "split-row";

        row.innerHTML = `
            <input type="text" class="split-name">
            <input type="number" class="split-percent" oninput="percentChanged(this)">
            <input type="number" class="split-wages" oninput="wagesChanged(this)">
            <input type="number" class="split-cis" readonly>
        `;
        splitContainer.appendChild(row);
    }

    function percentChanged(input) {
        const row = input.closest(".split-row");
        const percent = parseFloat(input.value) || 0;
        const grand = parseFloat(document.getElementById("grand-total").textContent) || 0;

        const wages = grand * (percent / 100);
        row.querySelector(".split-wages").value = wages.toFixed(2);
        row.querySelector(".split-cis").value = (wages * 0.8).toFixed(2);

        calcSplitTotals();
    }

    function wagesChanged(input) {
        const row = input.closest(".split-row");
        const wages = parseFloat(input.value) || 0;
        const grand = parseFloat(document.getElementById("grand-total").textContent) || 0;

        if (grand > 0) {
            row.querySelector(".split-percent").value = ((wages / grand) * 100).toFixed(2);
        }

        row.querySelector(".split-cis").value = (wages * 0.8).toFixed(2);
        calcSplitTotals();
    }

    function calcSplitTotals() {
        let totalCIS = 0;
        document.querySelectorAll(".split-cis").forEach(c => totalCIS += parseFloat(c.value) || 0);
        document.getElementById("final-total-cis").textContent = totalCIS.toFixed(2);
    }

    function submitBooking() {
        alert("Booking-Off Complete.");
    }
</script>

</body>
</html>
