<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Squad Sign Up â€“ BrickBook</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="assets/style.css">

<style>
:root {
  --blue: #1B73E8;
  --bg: #F5F7FA;
  --card: #FFFFFF;
  --border: #E5E7EB;
  --text-muted: #6B7280;
  --shadow: 0 8px 28px rgba(0,0,0,0.06);
}

body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: var(--bg);
}

/* Header */
header {
  background: var(--card);
  padding: 18px 24px;
  display: flex;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
}

header nav a {
  margin-left: 20px;
  text-decoration: none;
  font-weight: 600;
  color: #000;
}

.wrapper {
  max-width: 480px;
  margin: 30px auto;
  padding: 20px;
}

.card {
  background: var(--card);
  padding: 26px;
  border-radius: 18px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
}

.card-title {
  font-size: 26px;
  font-weight: 800;
  margin-bottom: 14px;
  text-align: center;
}

input {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid var(--border);
  margin-bottom: 16px;
}

.btn-primary {
  width: 100%;
  background: var(--blue);
  color: white;
  padding: 14px;
  border-radius: 12px;
  font-weight: 700;
  border: none;
  cursor: pointer;
}

.invite-box {
  padding: 12px;
  background: #e9f1ff;
  border-left: 4px solid var(--blue);
  border-radius: 6px;
  margin-bottom: 18px;
}
</style>

</head>
<body>

<header>
  <div class="logo">BrickBook</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="contractor-login.html">Contractor</a>
    <a href="squad-login.html">Squad Login</a>
  </nav>
</header>

<div class="wrapper">

  <div class="card">

    <div class="card-title">Squad Sign Up</div>

    <div id="inviteInfo" class="invite-box" style="display:none;"></div>

    <input type="text" id="fullName" placeholder="Full Name">
    <input type="email" id="email" placeholder="Email Address">
    <input type="password" id="password" placeholder="Create Password">

    <button class="btn-primary" onclick="registerSquad()">Create Account</button>

  </div>

</div>

<script>
/* ==========================
   READ INVITE FROM URL
========================== */
const params = new URLSearchParams(window.location.search);
const inviteCode = params.get("invite");

let inviteData = null;

/* FIND invite by code */
function loadInvite() {
  if (!inviteCode) return;

  for (let key in localStorage) {
    if (key.startsWith("invite_")) {
      const data = JSON.parse(localStorage.getItem(key));
      if (data.inviteCode === inviteCode) {
        inviteData = data;
        break;
      }
    }
  }

  if (!inviteData) {
    document.getElementById("inviteInfo").style.display = "block";
    document.getElementById("inviteInfo").innerHTML =
      `<strong>Invite not found.</strong><br>Please check your link.`;
    return;
  }

  // Show invite info
  const infoBox = document.getElementById("inviteInfo");
  infoBox.style.display = "block";
  infoBox.innerHTML = `
    <strong>Invite Found</strong><br>
    You are joining: <strong>${inviteData.squadId}</strong><br>
    Contractor invited: <strong>${inviteData.name}</strong>
  `;

  // Autofill fields
  document.getElementById("fullName").value = inviteData.name;
  document.getElementById("email").value = inviteData.email;
}

/* ==========================
   REGISTER SQUAD MEMBER
========================== */
function registerSquad() {
  const name = fullName.value.trim();
  const email = email.value.trim().toLowerCase();
  const password = password.value.trim();

  if (!name || !email || !password) {
    alert("Please fill all fields.");
    return;
  }

  if (!inviteData) {
    alert("Invalid or missing invite code.");
    return;
  }

  /* Save user to localStorage */
  const userObj = {
    name,
    email,
    password,
    squadId: inviteData.squadId,
    contractorId: inviteData.contractorId || "default",
    bookings: [],
    earnings: []
  };

  localStorage.setItem("squad_user_" + email, JSON.stringify(userObj));

  /* Mark invite used */
  inviteData.status = "accepted";
  localStorage.setItem("invite_" + email, JSON.stringify(inviteData));

  /* Add to squad group */
  let squads = JSON.parse(localStorage.getItem("contractor_squads"));
  const squad = squads.find(s => s.squadId === inviteData.squadId);
  squad.members.push(email);
  localStorage.setItem("contractor_squads", JSON.stringify(squads));

  alert("Account created! You can now log in.");

  window.location.href = "squad-login.html";
}

/* INIT */
loadInvite();

</script>

</body>
</html>
