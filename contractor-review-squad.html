<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Review Submission – BrickBook</title>

<style>
:root {
    --blue: #1B73E8;
    --charcoal: #2D2D2D;
    --lightgrey: #F5F7FA;
    --white: #FFFFFF;
    --green: #2ECC71;
    --danger: #E74C3C;
    --pending: #F1C40F;
    --shadow: 0 4px 14px rgba(0,0,0,0.08);
}

/* GENERAL */
body {
    margin: 0;
    background: var(--lightgrey);
    font-family: 'Inter', Arial, sans-serif;
}

/* HEADER */
header {
    background: white;
    padding: 18px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #E5EAF0;
}
.logo { font-size: 22px; font-weight: 800; }

nav a { margin-left: 20px; text-decoration: none; color: var(--charcoal); font-weight: 600; }
nav a:hover { color: var(--blue); }

.wrapper {
    max-width: 1100px;
    margin: auto;
    padding: 30px 20px 80px;
}

h1 { font-size: 28px; font-weight: 800; }
.subtitle { color: #555; margin-bottom: 24px; }

/* CARDS */
.card {
    background: var(--white);
    padding: 20px;
    margin-bottom: 22px;
    border-radius: 16px;
    box-shadow: var(--shadow);
}

.card-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 12px;
}

.plot-box {
    margin-bottom: 20px;
    padding: 14px;
    background: #FAFAFF;
    border-radius: 10px;
    border: 1px solid #eaeaea;
}

.plot-header {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 10px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 12px;
}

th, td {
    padding: 8px;
    border-bottom: 1px solid #e2e2e2;
    font-size: 14px;
}

thead {
    background: #e7efff;
}

/* PHOTOS */
.photo-preview {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
.photo-preview img {
    width: 120px;
    height: 120px;
    border-radius: 10px;
    object-fit: cover;
    border: 1px solid #ddd;
}

/* SQUAD SPLIT */
.split-row {
    display: grid;
    grid-template-columns: 1fr 90px 120px 120px;
    gap: 8px;
    margin-bottom: 8px;
}

.badge {
    padding: 6px 12px;
    border-radius: 8px;
    color: white;
    font-size: 13px;
    font-weight: 700;
}
.pending { background: var(--pending); }
.approved { background: var(--green); }
.rejected { background: var(--danger); }

textarea {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    margin-bottom: 18px;
    resize: vertical;
}

.btn-approve {
    padding: 14px 22px;
    background: var(--green);
    color: white;
    font-weight: 700;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    margin-right: 10px;
}

.btn-reject {
    padding: 14px 22px;
    background: var(--danger);
    color: white;
    font-weight: 700;
    border-radius: 12px;
    border: none;
    cursor: pointer;
}

@media(max-width: 768px) {
    .split-row { grid-template-columns: 1fr 70px 80px 80px; }
    th, td { font-size: 12px; }
    .photo-preview img { width: 100px; height: 100px; }
}
</style>
</head>

<body>

<header>
    <div class="logo">BrickBook</div>
    <nav>
        <a href="contractor-dashboard.html">Dashboard</a>
        <a href="contractor-review.html">Review</a>
        <a href="contractor-login.html">Logout</a>
    </nav>
</header>

<div class="wrapper">

    <h1>Review Submission</h1>
    <div class="subtitle">Inspect work, photos, totals and approve or reject.</div>

    <div class="card">
        <div class="card-title">Squad: <span id="squadName"></span></div>
        <div>Status: <span id="submissionStatus" class="badge pending">PENDING</span></div>
        <div style="margin-top:8px;">Submitted: <span id="submissionTime">Today 14:02</span></div>
    </div>

    <!-- PLOTS DISPLAY -->
    <div class="card">
        <div class="card-title">Plots Submitted</div>
        <div id="plotsContainer"></div>
    </div>

    <!-- SQUAD SPLIT -->
    <div class="card">
        <div class="card-title">Squad Split Summary</div>

        <div class="split-row" style="font-weight:700;">
            <div>Name</div>
            <div>%</div>
            <div>Wages (£)</div>
            <div>After CIS</div>
        </div>

        <div id="splitRows"></div>

        <div style="text-align:right; font-size:18px; font-weight:800; margin-top:10px;">
            Total: £<span id="totalPaid">0.00</span>
        </div>
    </div>

    <!-- CONTRACTOR NOTE -->
    <div class="card">
        <div class="card-title">Contractor Note (optional)</div>
        <textarea id="contractorNote" placeholder="Reason for rejection, feedback or site notes..."></textarea>

        <button class="btn-approve" onclick="approve()">Approve Booking</button>
        <button class="btn-reject" onclick="reject()">Reject Booking</button>
    </div>

</div>


<script>
/* TEMP DATA SIMULATING A REAL SUBMISSION FROM THE BOOKING PAGE */
let submission = {
    squad: "Team A",
    status: "pending",
    submitted: "Today 14:02",
    plots: [
        {
            plot: "44",
            notes: "Good progress today.",
            photos: ["https://picsum.photos/200?1", "https://picsum.photos/200?2"],
            rows: [
                { measurement: "Bricks", qty: 900, rate: 0.6 },
                { measurement: "Trench", qty: 4, rate: 25 },
                { measurement: "100mm", qty: 12, rate: 16 },
            ]
        },
        {
            plot: "45",
            notes: "Rain slowed things down.",
            photos: ["https://picsum.photos/200?3"],
            rows: [
                { measurement: "Bricks", qty: 600, rate: 0.6 },
                { measurement: "Commons", qty: 150, rate: 0.35 },
                { measurement: "Squad Hours", qty: 8, rate: 50 }
            ]
        }
    ],
    split: [
        { name: "John", percent: 40 },
        { name: "Ryan", percent: 30 },
        { name: "Sam", percent: 30 }
    ]
};


/* LOAD INTO PAGE */
document.getElementById("squadName").textContent = submission.squad;
document.getElementById("submissionStatus").textContent = submission.status.toUpperCase();
document.getElementById("submissionTime").textContent = submission.submitted;


/* LOAD PLOTS */
let plotHTML = "";
let grandTotal = 0;

submission.plots.forEach(p => {
    let rowsHTML = "";
    let plotTotal = 0;

    p.rows.forEach(r => {
        let total = r.qty * r.rate;
        plotTotal += total;

        rowsHTML += `
            <tr>
                <td>${r.measurement}</td>
                <td>${r.qty}</td>
                <td>£${r.rate}</td>
                <td><strong>£${total.toFixed(2)}</strong></td>
            </tr>
        `;
    });

    grandTotal += plotTotal;

    plotHTML += `
        <div class="plot-box">
            <div class="plot-header">Plot ${p.plot}</div>

            <table>
                <thead>
                    <tr><th>Measurement</th><th>Qty</th><th>Rate</th><th>Total</th></tr>
                </thead>
                <tbody>${rowsHTML}</tbody>
            </table>

            <strong>Notes:</strong><br>${p.notes}<br><br>

            <div class="photo-preview">
                ${p.photos.map(img => `<img src="${img}">`).join("")}
            </div>

            <div style="text-align:right; margin-top:12px; font-weight:700;">
                Plot Total: £${plotTotal.toFixed(2)}
            </div>
        </div>
    `;
});

document.getElementById("plotsContainer").innerHTML = plotHTML;

/* LOAD SPLIT */
let splitHTML = "";
let totalPaid = 0;

submission.split.forEach(s => {
    let wages = grandTotal * (s.percent / 100);
    let cis = wages * 0.8;
    totalPaid += cis;

    splitHTML += `
        <div class="split-row">
            <div>${s.name}</div>
            <div>${s.percent}%</div>
            <div>£${wages.toFixed(2)}</div>
            <div>£${cis.toFixed(2)}</div>
        </div>
    `;
});

document.getElementById("splitRows").innerHTML = splitHTML;
document.getElementById("totalPaid").textContent = totalPaid.toFixed(2);

/* APPROVE / REJECT ACTIONS */
function approve() {
    alert("Booking approved!");
    document.getElementById("submissionStatus").className = "badge approved";
    document.getElementById("submissionStatus").textContent = "APPROVED";
}

function reject() {
    let note = document.getElementById("contractorNote").value.trim();
    if (note.length < 3) {
        alert("Add a short reason for rejection.");
        return;
    }
    alert("Booking rejected.");
    document.getElementById("submissionStatus").className = "badge rejected";
    document.getElementById("submissionStatus").textContent = "REJECTED";
}
</script>

</body>
</html>
